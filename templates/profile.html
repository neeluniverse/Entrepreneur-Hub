{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-4 text-center">
        <img src="{{ user.avatar_url or 'https://via.placeholder.com/150' }}" class="rounded-circle mb-3" width="150" height="150">
        <h2>{{ user.name }}</h2>
        <p class="text-muted">Joined {{ user.created_at.strftime('%B %Y') }}</p>
        
        {% if user.bio %}
            <p>{{ user.bio }}</p>
        {% endif %}
        
        {% if user.skills %}
            <h5>Skills</h5>
            <p>{{ user.skills }}</p>
        {% endif %}
        
        {% if current_user.is_authenticated %}
            {% if current_user.id == user.id %}
                <a href="{{ url_for('edit_profile') }}" class="btn btn-outline-primary">Edit Profile</a>
            {% else %}
                <button class="btn btn-outline-primary" id="follow-btn" data-user-id="{{ user.id }}">
                    {% if is_following %}Unfollow{% else %}Follow{% endif %}
                </button>
                <a href="{{ url_for('conversation', user_id=user.id) }}" class="btn btn-outline-secondary">Message</a>
            {% endif %}
        {% endif %}
        
        <div class="mt-3">
            <strong>{{ user.followers.count() }}</strong> followers â€¢ 
            <strong>{{ user.following.count() }}</strong> following
        </div>
    </div>
    
    <div class="col-md-8">
        <h3>Posts</h3>
        {% for post in posts %}
            {% include 'post.html' %}
        {% else %}
            <p>No posts yet.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('follow-btn')?.addEventListener('click', function() {
        const userId = this.dataset.userId;
        fetch(`/follow/${userId}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    this.textContent = data.followed ? 'Unfollow' : 'Follow';
                    document.querySelector('strong').textContent = data.followers_count;
                }
            });
    });
</script>
{% endblock %}
